#'Clips TIF rasters
#'
#'@author Helge Jentsch
#'@import
#'@name clip.tif
#'
#'@param input.Raster.Location Directory where the files will loaded from. Default: Workling Directory.
#'@param save.location Directory where a directory will be created in which the files will be saved in. Default: Workling Directory.
#'@param new.Extent.Shapefile Path to a Shapefile.
#'@param buffer.Of.Shapefile Buffer around the Shapefile. Shapefile input required. Default: 0 degrees
#'@param new.Extent New extend numeric Vector. Following logic c(W, E, S, N) in degrees. Default: -180W, 180E, -90S, 90N (global extend)
#'@param include.Time.Stamp Logical. Whether a timestamp should be included in new directory name. Default: TRUE
clip.tif <- function(input.Raster.Location = "./",
                     save.location = "./",
                     new.Extent.Shapefile = NULL,
                     buffer.Of.Shapefile = 0,
                     new.Extent=c(-180,180,-90,90),
                     include.Time.Stamp = TRUE){
  if(is.null(input.Raster.Location)) stop()
  if(include.Time.Stamp == TRUE){
    date.stamp <- as.character(sys.time())
    date.stamp <- str_replace_all(date.stamp, pattern = ":", replacement = "-")
  }else{
    date.stamp <- ""
  }
  shortname <- unlist(str_split(input.Raster.Location, pattern = '/'))
  shortname <- shortname[length(shortname)]
  if(!is.null(new.Extent.Shapefile)){
    dir.create(paste0(save.location,"buffer_clipped_",date.stamp,"/"))
    # create a temporal raster object for clipping
    temp.raster <- raster(paste0(input.Raster.Location))
    # load new extent
    new.extent.temp <- extent(buffer(shapefile(new.Extent.Shapefile), width=buffer.Of.Shapefile))

    # crop (clip) the temporal raster to the new extent of the shapefile
    temp.raster <- crop(temp.raster, new.extent.temp)
    # write the cropped/clipped raster to the save location
    writeRaster(x = temp.raster,
                filename = paste0(save.location,"buffer_clipped_",date.stamp,"/clipped_",shortname),
                overwrite=T)
  }else{
    dir.create(paste0(save.location,"extent_clipped_",date.stamp,"/"))
    new.extent.input <- extent(new.Extent)
    # create a temporal raster object for clipping
    temp.raster <- raster(paste0(input.Raster.Location))
    # crop (clip) the temporal raster to the new extent of the shapefile
    temp.raster <- crop(temp.raster, new.extent.input)
    # write the cropped/clipped raster to the save location
    writeRaster(x = temp.raster,
                filename = paste0(save.location,"extent_clipped_",date.stamp,"/clipped_",shortname),
                overwrite=T)
  }
}
